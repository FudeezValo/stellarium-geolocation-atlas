<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellarium Geolocation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        /* Custom Font for a modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
        }
        /* Style for the map container */
        #map {
            height: 400px; /* Set a fixed height for the map */
            width: 100%;
            border-radius: 0.75rem; /* rounded-xl */
            border: 2px solid #6366f1; /* Indigo border for a tech/atlas look */
        }

        /* --- Custom Marker Animation (The "Stellarium" Effect) --- */

        /* The main container for the animated marker */
        .pulsing-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #e5e7eb; /* Star color (light gray) */
            box-shadow: 0 0 10px #e5e7eb; /* Initial glow */
            position: relative;
        }

        /* The pulsating ring */
        .pulsing-marker::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: rgba(99, 102, 241, 0.5); /* Semi-transparent indigo */
            animation: pulse 2s infinite ease-out; /* Apply the animation */
        }

        /* The CSS Keyframes for the Pulse Animation */
        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(3); /* Expands to 3x size */
                opacity: 0; /* Fades out completely */
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-lg bg-gray-900 shadow-2xl rounded-xl p-8 space-y-6 border-t-4 border-indigo-500 text-white">
        <h1 class="text-3xl font-bold text-gray-50 text-center">
            <span class="text-indigo-400">3I/ATLAS</span> Geolocation Atlas
        </h1>
        <p class="text-center text-gray-400">
            A real-time point on the star map.
        </p>
        
        <div id="map"></div>

        <div id="status" class="text-center text-blue-400 font-semibold h-6">
            Ready for celestial coordinates.
        </div>

        <div class="grid grid-cols-2 gap-4 text-center">
            <div class="bg-indigo-900/50 p-4 rounded-lg shadow-sm">
                <p class="text-sm font-medium text-indigo-400">Latitude (Lat)</p>
                <p id="latitude" class="text-2xl font-extrabold text-gray-100 mt-1">N/A</p>
            </div>
            <div class="bg-indigo-900/50 p-4 rounded-lg shadow-sm">
                <p class="text-sm font-medium text-indigo-400">Longitude (Lon)</p>
                <p id="longitude" class="text-2xl font-extrabold text-gray-100 mt-1">N/A</p>
            </div>
        </div>

        <button onclick="getLocation()"
                id="locate-button"
                class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg shadow-lg transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
            Locate User Position
        </button>

    </div>

    <script>
        // MapTiler API Key (provided by user)
        const MAPTILER_API_KEY = 'bWT53Ry9wqiUDn1WBX7N';

        // Initialize Map in a default location (e.g., Greenwich)
        const initialLat = 51.4779;
        const initialLon = 0.0015;
        const initialZoom = 2; // World view

        // Create the map object
        const map = L.map('map', {
            zoomControl: false, // Hide default zoom control
            scrollWheelZoom: false // Disable scroll zoom initially
        }).setView([initialLat, initialLon], initialZoom);

        // Add the MapTiler "DataViz Dark" layer for the starry/atlas look
        L.tileLayer(`https://api.maptiler.com/maps/dataviz-dark/{z}/{x}/{y}.png?key=${MAPTILER_API_KEY}`, {
            attribution: 'Map data &copy; <a href="https://www.maptiler.com/">MapTiler</a> contributors',
            maxZoom: 18,
        }).addTo(map);

        let userMarker = null; // Variable to hold the marker

        /**
         * Attempts to retrieve the user's current geographic location using the Geolocation API.
         */
        function getLocation() {
            const statusDiv = document.getElementById('status');
            const latSpan = document.getElementById('latitude');
            const lonSpan = document.getElementById('longitude');
            const locateButton = document.getElementById('locate-button');

            // Set loading state
            statusDiv.textContent = 'Scanning Earth\'s grid...';
            statusDiv.classList.remove('text-red-400', 'text-green-400');
            statusDiv.classList.add('text-blue-400');
            locateButton.disabled = true;
            locateButton.textContent = 'Locating...';
            latSpan.textContent = '...';
            lonSpan.textContent = '...';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // Success callback
                        const { latitude, longitude } = position.coords;

                        statusDiv.textContent = 'Location acquired. Star locked.';
                        statusDiv.classList.remove('text-blue-400');
                        statusDiv.classList.add('text-green-400');
                        latSpan.textContent = latitude.toFixed(6);
                        lonSpan.textContent = longitude.toFixed(6);

                        // 1. Update the Map Center and Zoom
                        map.setView([latitude, longitude], 13);
                        
                        // 2. Create the Animated Marker
                        const customIcon = L.divIcon({
                            className: 'custom-div-icon',
                            html: '<div class="pulsing-marker"></div>',
                            iconSize: [20, 20], 
                            iconAnchor: [10, 10]
                        });

                        // 3. Add or Move the Marker
                        if (userMarker) {
                            userMarker.setLatLng([latitude, longitude]);
                        } else {
                            userMarker = L.marker([latitude, longitude], { icon: customIcon }).addTo(map);
                        }

                        // Restore button
                        locateButton.disabled = false;
                        locateButton.textContent = 'Locate User Position';
                    },
                    (error) => {
                        // Error callback
                        statusDiv.classList.remove('text-blue-400');
                        statusDiv.classList.add('text-red-400');
                        latSpan.textContent = 'N/A';
                        lonSpan.textContent = 'N/A';
                        
                        let message = 'Unknown signal interference.';
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                message = 'Permission Denied: Location access blocked. Cannot acquire position.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                message = 'Position Unavailable: Location data not found on this device.';
                                break;
                            case error.TIMEOUT:
                                message = 'Timeout: The signal was lost during transmission.';
                                break;
                        }
                        statusDiv.textContent = `Error: ${message}`;

                        // Restore button
                        locateButton.disabled = false;
                        locateButton.textContent = 'Locate User Position';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 0
                    }
                );
            } else {
                // Geolocation API is not supported
                statusDiv.textContent = 'Geolocation hardware not supported by this browser.';
                statusDiv.classList.add('text-red-400');
                latSpan.textContent = 'N/A';
                lonSpan.textContent = 'N/A';
                locateButton.disabled = true;
                locateButton.textContent = 'System Not Found';
            }
        }
    </script>
</body>
</html>